name: Permanent-RDP-Secure

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: self-hosted

    steps:
    - name: Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… RDP
      run: |
        Write-Host "ğŸ‘¤ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… RDP Ø«Ø§Ø¨Øª..."
        $userExists = Get-LocalUser -Name "kamel007" -ErrorAction SilentlyContinue
        if (-not $userExists) {
          net user kamel007 Kamel@123 /add
          net localgroup administrators kamel007 /add
          Write-Host "âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… kamel007"
        } else {
          Write-Host "â„¹ï¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„"
        }

    - name: ØªÙØ¹ÙŠÙ„ RDP ÙˆÙØªØ­ Ø§Ù„Ø¨ÙˆØ±Øª 30120
      run: |
        Write-Host "ğŸ”§ ØªÙØ¹ÙŠÙ„ RDP..."
        Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server" -Name "fDenyTSConnections" -Value 0
        Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "UserAuthentication" -Value 0

        Write-Host "ğŸ›¡ï¸ Ø¶Ø¨Ø· Firewall Rules..."
        Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
        # Ø§Ù„Ø³Ù…Ø§Ø­ ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙˆØ±Øª 30120
        New-NetFirewallRule -DisplayName "Allow RDP Custom Port" -Direction Inbound -Action Allow -Protocol TCP -LocalPort 30120 -Profile Any

    - name: Ø¶Ø¨Ø· IP Ø«Ø§Ø¨Øª
      run: |
        Write-Host "ğŸ“Œ Ø¶Ø¨Ø· IP Ø«Ø§Ø¨Øª: 192.168.0.50"
        $interface = Get-NetAdapter | Where-Object { $_.Status -eq "Up" }
        New-NetIPAddress -InterfaceIndex $interface.InterfaceIndex -IPAddress 192.168.0.50 -PrefixLength 24 -DefaultGateway 192.168.0.1 -ErrorAction SilentlyContinue

    - name: Ø­Ø°Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø¥Ù„Ø§ Chrome
      run: |
        Write-Host "ğŸ§¹ Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ù…Ø«Ø¨ØªØ© Ø¨Ø§Ø³ØªØ«Ù†Ø§Ø¡ Google Chrome..."
        $apps = Get-WmiObject -Class Win32_Product | Where-Object { $_.Name -notlike "*Google Chrome*" }
        foreach ($app in $apps) {
          Write-Host "âŒ Ø¥Ø²Ø§Ù„Ø©: $($app.Name)"
          try {
            $app.Uninstall() | Out-Null
            Write-Host "âœ… ØªÙ… Ø§Ù„Ø­Ø°Ù"
          } catch {
            Write-Host "âš ï¸ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù: $($app.Name)"
          }
        }

    - name: ØªÙØ¹ÙŠÙ„ Ø­Ù…Ø§ÙŠØ© Windows Defender Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
      run: |
        Write-Host "ğŸ›¡ï¸ ØªÙØ¹ÙŠÙ„ Windows Defender ÙˆØ­Ù…Ø§ÙŠØ© Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ..."
        Set-MpPreference -DisableRealtimeMonitoring $false
        Set-MpPreference -EnableNetworkProtection Enabled
        Set-MpPreference -PUAProtection Enabled

    - name: ØªÙØ¹ÙŠÙ„ Account Lockout Policy
      run: |
        Write-Host "ğŸ”’ ØªÙØ¹ÙŠÙ„ Ø³ÙŠØ§Ø³Ø© Account Lockout Ø¶Ø¯ Brute Force..."
        secedit /export /cfg secconfig.cfg
        (Get-Content secconfig.cfg) -replace 'LockoutBadCount = 0', 'LockoutBadCount = 5' | Set-Content secconfig.cfg
        (Get-Content secconfig.cfg) -replace 'ResetLockoutCount = 0', 'ResetLockoutCount = 30' | Set-Content secconfig.cfg
        secedit /configure /db secedit.sdb /cfg secconfig.cfg /areas SECURITYPOLICY
        Remove-Item secconfig.cfg

    - name: Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø­Ù…Ø§ÙŠØ©
      run: |
        Write-Output "============================================"
        Write-Output "ğŸŒ IP Ø«Ø§Ø¨Øª: 192.168.0.50"
        Write-Output "ğŸ‘¤ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: kamel007"
        Write-Output "ğŸ”‘ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: Kamel@123"
        Write-Output "ğŸ”Œ Ø¨ÙˆØ±Øª RDP: 30120"
        Write-Output "ğŸ›¡ï¸ Ø­Ù…Ø§ÙŠØ© Ø£Ø³Ø§Ø³ÙŠØ© Ù…ÙØ¹Ù„Ø© (Firewall, Defender, Lockout Policy)"
        Write-Output "ğŸ“¢ ØªØ£ÙƒØ¯ Ù…Ù† ÙØªØ­ Ø§Ù„Ø¨ÙˆØ±Øª 30120 Ù…Ù† Ø§Ù„Ø±Ø§ÙˆØªØ± Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² Ø®Ù„Ù Ø´Ø¨ÙƒØ©"
        Write-Output "============================================"
